var UserService=angular.module("UserService",[]);UserService.factory("UserDataOp",["$http","baseUrl",function(t,e){var r=e+"/auth",o={};return o.addUser=function(e){return t.post(r+"/register",e)},o}]);var app=angular.module("paladin",["ui.router","ngStorage","UserService"]);app.constant("baseUrl","http://www.joinpaladin.com"),app.run(["$rootScope","$location","$localStorage","$state",function(t,e,r,o){t.$on("$stateChangeSuccess",function(){document.body.scrollTop=document.documentElement.scrollTop=0}),t.$on("$stateChangeStart",function(t,e,n,a,s,l){e.authorize===!0&&(e.resolve=e.resolve||{},"undefined"==typeof r.token&&(t.preventDefault(),o.go("login")))})}]),app.config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(t,e,r,o){t.state("home",{url:"/",templateUrl:"/partials/home.html"}).state("lawyers",{url:"/lawyers",templateUrl:"/partials/lawyer_info.html"}).state("enterprises",{url:"/enterprises",templateUrl:"/partials/enterprise_info.html"}).state("nonprofits",{url:"/nonprofits",templateUrl:"/partials/nonprofit_info.html"}).state("schools",{url:"/schools",templateUrl:"/partials/school_info.html"}).state("team",{url:"/team",templateUrl:"/partials/team-info.html"}).state("terms",{url:"/terms",templateUrl:"/partials/terms.html"}).state("faq",{url:"/faq",templateUrl:"/partials/faq.html"}).state("privacypolicy",{url:"/privacypolicy",templateUrl:"/partials/privacy-policy.html"}).state("signup",{url:"/signup",templateUrl:"/partials/signup.html",controller:"signupController","abstract":!0}).state("signup.userBase",{url:"",templateUrl:"/partials/signup-base.html"}).state("signup.lawyers",{url:"",templateUrl:"/partials/lawyer-profile-form.html"}).state("signup.students",{url:"",templateUrl:"/partials/student-profile-form.html"}).state("success",{url:"/success",templateUrl:"/partials/form-success.html"}).state("failure",{url:"/error",templateUrl:"/partials/form-error.html"}).state("reset-password",{url:"/resetPassword/:token",templateUrl:"/partials/reset-password.html",controller:"ResetPasswordController",resolve:{data:["$http","$stateParams","baseUrl",function(t,e,r){return t.post(r+"/auth/resetPassword/verify",e.token).then(function(t){return t.data},function(){return null})}]}}).state("login",{url:"/login",templateUrl:"/partials/login.html",controller:"LoginController"}).state("admin-home",{url:"/admin",templateUrl:"/partials/admin-home.html",controller:"AdminController",authorize:!0}).state("opportunity",{url:"/opportunity/:token",templateUrl:"/partials/opportunity-page.html",controller:"OpportunityController",resolve:{data:["$http","$stateParams","baseUrl",function(t,e,r){return t.post(r+"/opportunity/verify",e.token).then(function(t){return t.data},function(){return null})}]}}).state("enterpriseEnroll",{url:"/enterprises/:token/enroll",templateUrl:"/partials/enterprise-enroll.html",controller:"EnterpriseEnrollController",resolve:{data:["$http","$stateParams","baseUrl",function(t,e,r){return t.post(r+"/enterprises/get",e.token).then(function(t){return t.data},function(){return null})}]},"abstract":!0}).state("enterpriseEnroll.userBase",{url:"",templateUrl:"/partials/enterprise-enroll-base.html"}).state("enterpriseEnroll.lawyers",{url:"",templateUrl:"/partials/lawyer-profile-form.html"}).state("enterpriseEnroll.students",{url:"",templateUrl:"/partials/student-profile-form.html"}),e.otherwise("/"),o.interceptors.push(["$localStorage",function(t){return{request:function(e){return e.headers=e.headers||{},t.token&&(e.headers.Authorization=t.token),e}}}])}]),app.controller("signupController",["$scope","$state","UserDataOp","$http","baseUrl",function(t,e,r,o,n){o.get(n+"/auth/opportunityOptions").then(function(e){t.opportunityOptions=e.data}),o.get(n+"/auth/languageOptions").then(function(e){t.languageOptions=e.data}),o.get(n+"/auth/advocacyOptions").then(function(e){t.advocacyOptions=e.data}),t.user={},t.routeForm=function(){type=t.user.userType,"lawyer"==type?e.go("signup.lawyers"):"student"==type?e.go("signup.students"):t.submitForm()},t.submitForm=function(){r.addUser(t.user).success(function(){e.go("success")}).error(function(t){e.go("failure")})}}]),app.directive("dropdownMultiselect",function(){return{restrict:"AE",scope:{options:"=",pre_selected:"=preSelected",dropdownTitle:"@",model:"=ngModel",key:"@"},template:"<div class='scrollable-menu-container'><ul class='scrollable-menu'><li>{{dropdownTitle}}<span class='pull-right'><input type='checkbox' data-ng-change='checkAllClicked()' data-ng-model=checkAll> Check All</span></li><hr><li data-ng-repeat='option in options'> <input type='checkbox' data-ng-change='setSelectedItem(option)' ng-model='selectedItems[option.name]'> {{option.displayName}}</li></ul></div>",controller:["$scope",function(t){function e(){if(t.model||(t.model={}),key=t.key,t.model[key]=[],t.pre_selected){for(var e=0;e<t.pre_selected.length;e++)t.model[key].push(t.pre_selected[e].name),t.selectedItems[t.pre_selected[e].name]=!0;t.pre_selected.length==t.options.length&&(t.checkAll=!0)}}function r(){key=t.key,t.model[key]=[],t.selectedItems={},angular.forEach(t.options,function(e){t.selectedItems[e.name]=!0,t.model[key].push(e)}),angular.forEach(t.model[key],function(e){t.selectedItems[e]=!0})}function o(){key=t.key,t.model[key]=[],t.selectedItems={}}t.selectedItems={},t.checkAll=!1,e(),t.checkAllClicked=function(){t.checkAll?r():o()},t.setSelectedItem=function(e){key=t.key;var r=[];return t.model[key]||(t.model[key]=[]),1==t.selectedItems[e.name]?t.model[key].push(e):(r=$.grep(t.model[key],function(t){return t.name!=e.name}),t.model[key]=r,t.checkAll=!1),!1}}]}}),app.controller("headernav",["$scope",function(t){t.expanded=!1,t.toggleHeader=function(){t.expanded=t.expanded===!1?!0:!1}}]),app.controller("ResetPasswordController",["$http","$scope","data","baseUrl",function(t,e,r,o){e.data=r,e.$watch("confirmPassword",function(){e.password==e.confirmPassword?e.error=!1:e.error=!0}),e.processForm=function(){e.password==e.confirmPassword?(dto={token:e.data.token,password:e.password},t.post(o+"/auth/resetPassword/reset",dto).then(function(t){e.success=!0},function(){return null})):e.error=!0}}]),app.controller("LoginController",["$http","$scope","$localStorage","$state","baseUrl",function(t,e,r,o,n){e.processForm=function(){dto={email:e.email,password:e.password},t.post(n+"/auth/login",dto).then(function(t){r.token=t.data.token,o.go("admin-home")},function(){e.error=!0})}}]),app.controller("AdminController",["$http","$scope","$state","baseUrl",function(t,e,r,o){e.formData={},e.nonprofitData={},t.get(o+"/auth/opportunityOptions").then(function(t){e.opportunityOptions=t.data}),t.get(o+"/auth/languageOptions").then(function(t){e.languageOptions=t.data}),t.get(o+"/auth/advocacyOptions").then(function(t){e.advocacyOptions=t.data}),t.get(o+"/api/nonprofits/all").then(function(t){e.nonprofits=t.data}),e.submitOpportunity=function(){t.post(o+"/api/opportunity/submit",e.formData).then(function(t){r.go(r.current,{},{reload:!0})},function(){e.error=!0})},e.submitNonprofit=function(){t.post(o+"/api/nonprofit/submit",e.nonprofitData).then(function(t){r.go(r.current,{},{reload:!0})},function(){e.error=!0})},e.submitEnterprise=function(){t.post(o+"/api/enterprise/submit",e.enterpriseData).then(function(t){r.go(r.current,{},{reload:!0})},function(){e.error=!0})}}]),app.controller("opportunitySelectController",["$http","$scope","$state","baseUrl",function(t,e,r,o){e.sortType="name",e.sortReverse=!1,e.searchTerm="",t.get(o+"/api/opportunities/all").then(function(t){e.opportunities=t.data}),t.get(o+"/api/users/all").then(function(t){e.users=t.data}),t.get(o+"/api/nonprofits/all").then(function(t){e.nonprofits=t.data}),t.get(o+"/api/enterprises/all").then(function(t){e.enterprises=t.data}),e.selectedItems={},e.matchEmail={},e.setSelectedItem=function(t){e.matchEmail.opportunities||(e.matchEmail.opportunities=[]);var r=[];return 1==e.selectedItems[t.id]?e.matchEmail.opportunities.push(t):(r=$.grep(e.matchEmail.opportunities,function(e){return e.id!=t.id}),e.chosenOpps=r),!1},e.sendMatchEmail=function(){t.post(o+"/api/users/sendMatchEmail",e.matchEmail).then(function(t){r.go(r.current,{},{reload:!0})},function(){e.error=!0})},e.pairUserAndOpportunity=function(){t.post(o+"/api/users/pairOpportunity",e.opportunitySelect).then(function(t){r.go(r.current,{},{reload:!0})},function(){e.error=!0})}}]),app.controller("OpportunityController",["$http","$scope","$state","data","baseUrl",function(t,e,r,o,n){o&&(e.opportunity=o.opportunity),e.selectOpportunity=function(){t.post(n+"/opportunity/select",o.token).then(function(t){e.success=!0},function(){e.error=!0})}}]),app.controller("EnterpriseEnrollController",["$http","$scope","$state","data","baseUrl","UserDataOp",function(t,e,r,o,n,a){e.user={},o&&(e.user.organization=o,e.success=!0),t.get(n+"/auth/opportunityOptions").then(function(t){e.opportunityOptions=t.data}),t.get(n+"/auth/languageOptions").then(function(t){e.languageOptions=t.data}),t.get(n+"/auth/advocacyOptions").then(function(t){e.advocacyOptions=t.data}),e.processForm=function(){a.addUser(e.user).success(function(){r.go("success")}).error(function(t){r.go("failure")})},e.routeForm=function(){type=e.user.organization.formType,"students"==type?(e.user.userType="student",r.go("enterpriseEnroll.students")):(e.user.userType="lawyer",r.go("enterpriseEnroll.lawyers"))}}]);